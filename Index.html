
<html >
    <head>
        <link rel = "stylesheet" href = "styles/styles.css">
        <link rel = "stylesheet" href = "styles/icons.css"> 
        <link rel = "stylesheet" href = "styles/myForm.css">
        <link rel = "stylesheet" href = "styles/video.css">
       
        <title>
            Login
        </title>

        </head>
        <body class = "login-style">


            
            
            <div class="title">
                  <span> IC1 - Login</h1> 
                
            </div>
            <!-- the action added to the form is where we submit to the link to the server -->
            <!-- meaning the link to our php page -->
            <!-- for this session we goin to make the action taking us to just another page (fistapage) -->
            <div class ="paragraph">
         
                <!-- post : does not show the data sent with url while get does -->
                <form  action = "BE/login.php" method = "POST" ID = "login-form">
                    <label for= "un" >User name</label>
                    <br>
                    <input type = "text" name= "username" id = un class="textfield">
                    <br> 
                    <label for= "un" >Password</label>
                    <br>
                    <input type = "password" name = "password" id= pass class= "textfield" >
                    <br>
                    <a href= "Index.html">Forgot Password?</a>
                    <br>
                    <br>
                    <input type="button"  value="Login" class="mbutton" onclick="login()">
                    <input type="button" value="Cancel" class="cancel" onclick="clearForm()">
                </form>

                    
            </div>

           

            <!-- now we create our javascript -->
            <script>
             function login() {
                var un = document.getElementById('un').value;
                var pass = document.getElementById('pass').value;


                if (un == '' || pass == '') {
                    alert('You must fill in the username and password!');
                } else {
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', 'BE/login.php');
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    xhr.onload = function () {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        if (response.success) {
                          if (response.change_password) {
                            alert ("user logged in but need to change password");
                            window.location.href = 'BE/change_password.php';
                            } else {
                            alert ("user logged in");
                            window.location.href = 'pages/firstpage.php';
                             } 
                        } else {
                        alert(response.message);
                        }

                    } else {
                        alert('Request failed.  Returned status of ' + xhr.status);
                    }
                    };
                    xhr.send('username=' + encodeURIComponent(un) + '&password=' + encodeURIComponent(pass));
                }
                }

                function clearForm() {
                document.getElementById('un').value = '';
                document.getElementById('pass').value = '';
                }


            </script>

        </body>
    </html>